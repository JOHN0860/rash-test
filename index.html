<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rash Test System</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script defer src="https://unpkg.com/mathlive"></script>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f4; padding: 15px; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #0088cc; }
        .question { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .option-btn { padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: white; cursor: pointer; }
        .option-btn.selected { background: #0088cc; color: white; border-color: #0088cc; }
        math-field { width: 100%; border: 1px solid #ddd; border-radius: 5px; padding: 5px; font-size: 1.2rem; }
        #send-btn { width: 100%; padding: 15px; background: #28a745; color: white; border: none; border-radius: 5px; font-size: 16px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Matematika Testi</h2>
    <div id="test-container"></div>
    <button id="send-btn" onclick="sendAnswers()">Javoblarni yuborish</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // WebAppni to'liq ekranda ochish

    const testContainer = document.getElementById('test-container');
    const answers = {};

    // 1 dan 55 gacha savollarni generatsiya qilish
    for (let i = 1; i <= 55; i++) {
        const qDiv = document.createElement('div');
        qDiv.className = 'question';
        
        if (i <= 32) {
            // 1-32: A, B, C, D variantlar
            qDiv.innerHTML = `
                <p><strong>${i}-savol:</strong> Variantni tanlang:</p>
                <div class="options">
                    ${['A', 'B', 'C', 'D'].map(opt => `
                        <button class="option-btn" id="q${i}${opt}" onclick="selectOption(${i}, '${opt}')">${opt}</button>
                    `).join('')}
                </div>
            `;
        } else {
            // 33-55: Matematik klaviatura (Math-field)
            qDiv.innerHTML = `
                <p><strong>${i}-savol:</strong> Javobni kiriting:</p>
                <math-field id="q${i}" oninput="saveMath(${i}, this.value)"></math-field>
            `;
        }
        testContainer.appendChild(qDiv);
    }

    // Variant tanlash funksiyasi
    function selectOption(qNum, opt) {
        ['A', 'B', 'C', 'D'].forEach(o => {
            document.getElementById(`q${qNum}${o}`).classList.remove('selected');
        });
        document.getElementById(`q${qNum}${opt}`).classList.add('selected');
        answers[qNum] = opt;
    }

    // Matematik javobni saqlash
    function saveMath(qNum, val) {
        answers[qNum] = val;
    }

    // Natijalarni Botga yuborish
    function sendAnswers() {
        if (Object.keys(answers).length === 0) {
            alert("Hech bo'lmasa bitta javob belgilang!");
            return;
        }
        // Ma'lumotni JSON ko'rinishida botga jo'natish
        tg.sendData(JSON.stringify(answers));
        tg.close();
    }
</script>

</body>
</html>
